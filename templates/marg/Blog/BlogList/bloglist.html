{% load static %}

{% block content %}
<section class="blog">
  <!-- Search Form -->
<form class="d-flex position-relative" role="search" action="{% url 'post-search' %}" method="get">
  <input
    class="form-control me-2"
    type="search"
    name="query"
    placeholder="Search"
    aria-label="Search"
    value="{{ query }}"
    id="searchInput"
  />
  
  <!-- Clear button (only shows when there's text) -->
  <button 
    type="button" 
    id="clearSearch" 
    class="btn btn-sm position-absolute" 
    style="right: 60px; top: 50%; transform: translateY(-50%); z-index: 10; display: none; background: none; border: none; color: #6c757d;"
  >
    <i class="fa-solid fa-xmark"></i>
  </button>
  
  <button class="btn btn-outline-success" type="submit">Search</button>
</form>

  <div class="head" style="margin-top: 60px;">
    <div class="head-title">
      <h2 class="blog-title">Marg Career Blog</h2>
    </div>

    <!-- Button to create the post -->
    <div class="head-add">
      <input type="text" placeholder="What's on your mind......" readonly />
      <button class="open-modal-btn">+</button>
    </div>
  </div>

  <!-- Create Post Modal -->
  <div class="modal" id="postModal">
    <div class="modal-content">
      <h2>Create Post</h2>

      <form id="postForm" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.media }}

        {% for field in form %}
        <div class="input-group">
          {{ field.label_tag }}
          {{ field }}
          {% if field.errors %}
          <div class="error">{{ field.errors }}</div>
          {% endif %}
        </div>
        {% endfor %}

        <div class="buttons">
          <button class="cancel-btn" type="button">Cancel</button>
          <button class="post-btn" type="submit">Post</button>
        </div>
      </form>
    </div>
  </div>

  {% if query %}
    <p>Showing results for: "<strong>{{ query }}</strong>"</p>
  {% endif %}

  <!-- Blog Posts List -->
  <div class="body-box">
    {% for post in page_obj %}
    <div class="body-box-item-1 body-box-item">
      <img src="{{ post.featured_image.url }}" alt="{{ post.title }}" />

      <h3>
        <a href="{% url 'post-detail' post.pk %}" class="post-title">{{ post.title }}</a>
      </h3>

      <p>{{ post.description | striptags | truncatewords:40 }}</p>

      <div class="meta-info">
        <span class="comments-count">{{ post.comment_set.count }} comments</span>
        <div class="tags">
          {% for tag in post.tag.all %}
          <span class="tag-item">{{ tag.name }}</span>
          {% endfor %}
        </div>
      </div>

      <a href="{% url 'post-detail' post.pk %}" class="read-more-btn">
        <span>Read more</span>
        <i class="fa-solid fa-arrow-right"></i>
      </a>
    </div>
    {% empty %}
    <p>No posts available.</p>
    {% endfor %}
  </div>

  <!-- Pagination -->
  <div class="pagination mt-4">
    {% if page_obj.has_previous %}
      <a href="?query={{ query }}&page={{ page_obj.previous_page_number }}">Previous</a>
    {% endif %}
    <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a href="?query={{ query }}&page={{ page_obj.next_page_number }}">Next</a>
    {% endif %}
  </div>
</section>
{% endblock %}
